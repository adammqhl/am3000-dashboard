<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WE-OD Dashboard</title>
<style>
/* --- Base & Table Styles --- */
body { font-family: Arial, sans-serif; padding: 20px; background-color: #ffffff; color: #333; }
h2 { font-weight: 800; font-size: 80px; text-align: center; margin:0 0 20px 0; letter-spacing: 5px; }
.table-container { position: relative; margin-bottom: 50px; }
table { width: 100%; border-collapse: collapse; table-layout: fixed; box-shadow: 0 2px 5px rgba(0,0,0,0.1); background:#fff; }
th, td { border:1px solid #ccc; padding:5px 3px; text-align:center; font-size:10px; white-space:nowrap; height:25px; font-weight:bold; }
th { background:#f8f8f8; }
tr.non-production-row td { background:#eef4ff; color:#8899aa; }
.data-cell { background:#fff; font-weight:bold; position:relative; z-index:2; }
#arrow-overlay { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:10; }
.connection-path { stroke: rgba(220,53,69,0.6); stroke-width:2; fill:none; }
/* --- Edit / Password --- */
#edit-toggle-btn { display:block; margin:-10px auto 20px auto; padding:8px 16px; font-weight:bold; color:#fff; background:#007bff; border:none; border-radius:5px; cursor:pointer; }
#edit-toggle-btn.locked { background:#dc3545; }
#password-prompt { display:none; margin:20px auto; padding:15px; background:#f0f0f0; border:1px solid #ccc; width:300px; text-align:center; }
#editing-panel-container { display:none; margin-top:30px; opacity:0; transform:translateY(20px); transition:all 0.3s; }
#editing-panel-container.visible { display:block; opacity:1; transform:translateY(0); }
/* ...keep other styles from your code... */
</style>
</head>
<body>

<h2>WE-OD</h2>
<hr>
<button id="edit-toggle-btn">Unlock Editing</button>

<div id="password-prompt">
  <label>Enter Edit Password:</label>
  <input type="password" id="password-input" placeholder="Password...">
  <div id="password-error" style="color:red; margin-top:5px;"></div>
</div>

<div class="table-container">
  <svg id="arrow-overlay">
    <defs>
      <marker id="arrowhead" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
        <polygon points="0 0, 6 3, 0 6" fill="rgba(220,53,69,0.6)"/>
      </marker>
    </defs>
  </svg>
  
  <table>
    <thead>
      <tr>
        <th rowspan="3">Month</th>
        <th rowspan="3">Day</th>
        <th colspan="4" rowspan="2">Archivement</th>
        <th colspan="18">Simulation Plan</th>
      </tr>
      <tr>
        <th colspan="4" class="hrv">HR-V</th>
        <th colspan="4" class="wrv">WR-V</th>
        <th colspan="5" class="city4d">City 4D</th>
        <th colspan="5" class="city5d">City 5D</th>
      </tr>
      <tr>
        <th>Daily Target</th>
        <th>OT Plan</th>
        <th>Plan Day/Night</th>
        <th>Shift</th>
        <th class="hrv">S</th> <th class="hrv">E</th> <th class="hrv">V</th> <th class="hrv">HEV</th>
        <th class="wrv">LESS</th> <th class="wrv">E</th> <th class="wrv">V</th> <th class="wrv">RS</th>
        <th class="city4d">S</th> <th class="city4d">E</th> <th class="city4d">V</th> <th class="city4d">RS</th> <th class="city4d">HEV</th>
        <th class="city5d">S</th> <th class="city5d">E</th> <th class="city5d">V</th> <th class="city5d">RS</th> <th class="city5d">HEV</th>
      </tr>
    </thead>
    <tbody id="production-schedule-body"></tbody>
  </table>
</div>

<div id="editing-panel-container">
  <!-- Your Step Wizard HTML stays here -->
</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbySCaYNySVZFB4GcPgcXGAQiaWRsqE_Esj93keeqzuvd7BbnojTkkl87r_xtCanf4c7uQ/exec';
let isEditMode = false;
const correctPassword = "AM3000";
let currentCapacityData = {};
let globalProductionQueue = [];
let selectedDays = new Set();
let arrowConnections = [];

// --- FETCH DATA ---
async function fetchMonthData(month, year) {
  try {
    const res = await fetch(`${API_URL}?action=fetch&month=${month}&year=${year}`);
    const data = await res.json();
    currentCapacityData = data;
    generateTable(month, year);
  } catch (err) { console.error("Fetch failed:", err); }
}

// --- SAVE DATA ---
async function saveTargetsToSheet() {
  const payload = { action: "update", data: currentCapacityData };
  try {
    const res = await fetch(API_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload) });
    const result = await res.json();
    alert(result.message || "Saved successfully!");
  } catch(err) { console.error(err); alert("Error saving data!"); }
}

// --- Include all your other JS functions from previous code ---
// initializeMonthData, generateTable, drawArrowOverlay, calendar, sequences, etc.

initializeMonthData(10,2025);
generateTable(10,2025);
</script>
</body>
</html>
